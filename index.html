<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: light)">
<meta name="theme-color" content="#222" media="(prefers-color-scheme: dark)"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/uploads/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/uploads/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/uploads/favicon-16x16-next.png">
  <link rel="mask-icon" href="/uploads/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"chiujun.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":true,"version":"8.17.1","exturl":false,"sidebar":{"position":"left","display":"always","padding":18,"offset":12},"copycode":{"enable":true,"style":null},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"disqus","storage":true,"lazyload":false,"nav":null,"activeClass":"disqus"},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Personal Blog">
<meta property="og:type" content="blog">
<meta property="og:title" content="ChiuJun&#39;s Blog">
<meta property="og:url" content="https://chiujun.github.io/index.html">
<meta property="og:site_name" content="ChiuJun&#39;s Blog">
<meta property="og:description" content="Personal Blog">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ChiuJun">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://chiujun.github.io/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":true,"isPost":false,"lang":"zh-CN","comments":"","permalink":"","path":"index.html","title":""}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>ChiuJun's Blog</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">ChiuJun's Blog</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-overview-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="ChiuJun"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">ChiuJun</p>
  <div class="site-description" itemprop="description">Personal Blog</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">5</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">18</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/ChiuJun" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;ChiuJun" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:lj.chiu@outlook.com" title="E-Mail → mailto:lj.chiu@outlook.com" rel="noopener me external nofollow noreferrer" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh" class="cc-opacity" rel="noopener external nofollow noreferrer" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner index posts-expand">

    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chiujun.github.io/posts/52e9b435.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ChiuJun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ChiuJun's Blog">
      <meta itemprop="description" content="Personal Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ChiuJun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/52e9b435.html" class="post-title-link" itemprop="url">什么是网桥</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-24 23:50:00" itemprop="dateCreated datePublished" datetime="2023-07-24T23:50:00+00:00">2023-07-24</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/posts/52e9b435.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/52e9b435.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.1k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>4 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <h2 id="引言">引言</h2>
<p>为什么会有这种疑惑呢？因为在学习计算机网络基础的时候总会看到相关的网络设备介绍，但似乎搜不到网桥这种设备有零售。同时网桥这种字眼在一些<code>Linux</code>操作系统中又很常见，比如<code>OpenWrt</code>。遂使用中文搜索，点进了知乎的一个<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.zhihu.com/question/67473683">提问</a>越看越迷糊，包括常见的问答社区 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://superuser.com/">Super User</a> 中的一篇<a target="_blank" rel="noopener external nofollow noreferrer" href="https://superuser.com/questions/696018/is-the-idea-that-a-switch-is-a-multiport-bridge-accurate">帖子</a>也有回答错误连篇。以至于前期甚至混淆了虚拟机软件 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.virtualbox.org/">VirtualBox</a> 中提供的网络适配器类型<code>桥接适配器(Bridged Adapter)</code>与网桥的概念，遂决定多查找资料搞清楚网桥到底是个什么玩意。</p>
<h2 id="定义">定义</h2>
<p>什么是网桥？可以用 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.oreilly.com/library/view/tcpip-illustrated-volume/9780132808200/"><em>TCP/IP Illustrated,Volume 1 The Protocols</em></a> 中的一句话概括：</p>
<blockquote>
<p><em>TCP/IP Illustrated,Volume 1 The Protocols</em></p>
<p><strong>3.4 Bridges and Switches</strong></p>
<p>The IEEE 802.1d standard specifies the operation of bridges, and thus switches, which are essentially high-performance bridges.</p>
<p>IEEE 802.1d 标准规定了网桥的操作，交换机本质上是高性能的网桥。</p>
</blockquote>
<p>翻一翻 IEEE 802.1d 标准的文档，网桥被定义为一个网络桥接设备。符合其定义并具有相应功能的都可以被称为网桥，该标准定义的网桥要求至少拥有两个端口，而交换机则是一种多端口网桥（Multiport Bridge）设备。虽然在好几个地方看到说网桥和交换机可以作为同义替换的术语，但主观感受是交换机这个名字已经近乎替代了网桥。</p>
<blockquote>
<p><em>IEEE Std 802.1D-2004, IEEE Standard for Local and metropolitan area networks: Media Access Control (MAC) Bridges</em></p>
<p><strong>7.1 Bridge operation</strong></p>
<p>The principal elements of Bridge operation are as follows:</p>
<ol type="a">
<li>Relay and filtering of frames.</li>
<li>Maintenance of the information required to make frame filtering and relaying decisions.</li>
<li>Management of the above.</li>
</ol>
</blockquote>
<h2 id="发展历史">发展历史</h2>
<p>如果说作为实体设备，网桥和交换机是一种东西，为什么还要给他再起个名字呢？这得从他的发展历史说起，参照维基百科贴的内容，在80年代现代意义上的MAC网桥被发明之后出现了多端口网桥，到了90年代 Kalpana, Inc. 给自家采用了直通交换技术（cut-through forwarding）的次世代网桥起了个名字 EtherSwitch ，因为该技术相较于传统的存储转发技术（Store and forward）引入的延迟更低，之后随着产品推广交换机这个名字就逐渐被广泛使用了。</p>
<blockquote>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch">Wikipedia: Network switch</a></p>
<p>The first MAC Bridge[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch#cite_note-3">3]</a>[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch#cite_note-4">4]</a>[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch#cite_note-5">5]</a> was invented[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch#cite_note-6">6]</a> in 1983 by Mark Kempf, an engineer in the Networking Advanced Development group of <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Digital_Equipment_Corporation">Digital Equipment Corporation</a>. The first 2 port Bridge product (LANBridge 100) was introduced by that company shortly after. The company subsequently produced multi-port switches for both Ethernet and <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Fiber_Distributed_Data_Interface">FDDI</a> such as GigaSwitch. Digital decided to license its MAC Bridge patent in a royalty-free, non-discriminatory basis that allowed IEEE standardization. This permitted a number of other companies to produce multi-port switches, including <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Kalpana_(company)">Kalpana</a>.[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch#cite_note-7">7]</a></p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Kalpana,_Inc.">Wikipedia: Kalpana,_Inc.</a></p>
<p>In 1989 and 1990, Kalpana introduced the first multiport <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Ethernet">Ethernet</a> switch, its seven-port EtherSwitch.[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Kalpana,_Inc.#cite_note-networkcomputing_2000-5">5]</a> The invention of Ethernet switching made Ethernet networks faster, cheaper, and easier to manage. Multi-port <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Network_switch">network switches</a> became common, gradually replacing <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Ethernet_hub">Ethernet hubs</a> for almost all applications, and enabled an easy transition to 100-megabit <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Fast_Ethernet">Fast Ethernet</a> and later <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Gigabit_Ethernet">Gigabit Ethernet</a>.[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Kalpana,_Inc.#cite_note-att_press_1995-6">6]</a>[<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Kalpana,_Inc.#cite_note-hardware.com-7">7]</a></p>
</blockquote>
<h2 id="杂记">杂记</h2>
<p>搜索的过程中还看到了一些有意义的资料，简单记录下</p>
<ol type="1">
<li><p>关于 Linux Bridge</p>
<ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://wiki.linuxfoundation.org/networking/bridge">Linux Wiki: bridge</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://wiki.linuxfoundation.org/networking/iproute2">Linux Wiki: iproute2</a></li>
</ul></li>
<li><p>关于 VirtualBox 的各种网络适配器</p>
<ul>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.virtualbox.org/manual/ch06.html">Oracle® VM VirtualBox® User Manual Chapter 6. Virtual Networking</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.nakivo.com/blog/install-ubuntu-on-virtualbox-virtual-machine/">VirtualBox network setting guide</a></li>
<li><a target="_blank" rel="noopener external nofollow noreferrer" href="https://zhuanlan.zhihu.com/p/554893004">VirtualBox网络配置超全详解</a></li>
</ul></li>
<li><p>关于各种网络设备</p>
<ul>
<li><p>IEEE 802.3 中关于 Repeater 的描述</p>
<blockquote>
<p><em>IEEE Std 802.3-2018, IEEE Standard for Ethernet</em></p>
<p><strong>29.1.2 Repeater usage</strong></p>
<p>Repeaters are the means used to connect segments of a network medium together into a single collision domain. Different signaling systems (i.e., 100BASE-T2, 100BASE-T4, 100BASE-TX, 100BASE-FX) can be joined into a common collision domain using repeaters. Bridges can also be used to connect different signaling systems; <strong>however, if a bridge is so used, each system connected to the bridge will be a separate collision domain.</strong></p>
</blockquote></li>
<li><p><em>Data Communications and Networking</em> 中关于 Hub 的描述</p>
<blockquote>
<p><em>Data Communications and Networking with TCP/IP Protocol Suite</em></p>
<p><strong>6.1.1 Hubs</strong></p>
<p>A <strong>hub</strong> is a device that operates only in the physical layer. Signals that carry information within a network can travel a fixed distance before attenuation endangers the integrity of the data. A <strong>repeater</strong> receives a signal and, before itbecomes too weak or corrupted, <em>regenerates</em> and <em>retimes</em> the original bit pattern. The repeater then sends the refreshed signal. In the past, when Ethernet LANs were using bus topology, a repeater was used to connect two segments of a LAN to overcome the length restriction of the coaxial cable. Today, however, Ethernet LANs use star topology. In a star topology, a repeater is a multiport device, often called a <em>hub</em>, that can be used to serve as the connecting point and at the same time function as a repeater.</p>
</blockquote></li>
<li><p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.geeksforgeeks.org/network-devices-hub-repeater-bridge-switch-router-gateways/">Network Devices (Hub, Repeater, Bridge, Switch, Router, Gateways and Brouter)</a></p></li>
</ul></li>
</ol>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chiujun.github.io/posts/38cbcb60.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ChiuJun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ChiuJun's Blog">
      <meta itemprop="description" content="Personal Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ChiuJun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/38cbcb60.html" class="post-title-link" itemprop="url">MB、MiB与Mbps之间的区别与联系</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-12 21:39:20" itemprop="dateCreated datePublished" datetime="2023-07-12T21:39:20+00:00">2023-07-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-19 23:52:00" itemprop="dateModified" datetime="2023-07-19T23:52:00+00:00">2023-07-19</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/" itemprop="url" rel="index"><span itemprop="name">基础知识</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/posts/38cbcb60.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/38cbcb60.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p>这个话题的由头是在<code>HCIE-Datacom</code>试听课程中老师提到了<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Ethernet_hub">以太网集线器（Ethernet Hub）</a>可以工作在<code>10BASE-T</code>以太网中，而其中的数字<code>10</code>指的是带宽（Bandwidth）也就是数据传输速率为<code>10 Mbit/s</code>，也可以写作<code>10 Mbps</code>。这两者的<code>M</code>前缀都是<code>mega</code>的符号表示，<code>mega</code>等同于<span class="math inline">\(10^6\)</span>。众所周知<code>1 Byte = 8 bits</code>，所以可以得出<code>10 Mbit/s = 10/8 MB/s = 1.25 MB/s</code>。</p>
<p>以上的推论看起来似乎没什么问题，但转念一想不对啊，我的概念里不应该是<code>1 MB = 1024 KB = 1024*1024 B</code>，这乘数<span class="math inline">\(10^6\)</span>与<span class="math inline">\(2^{20}\)</span>都不一样怎么能直接除8呢？于是转而Google之搞清楚了其中的细节对错：</p>
<ol type="1">
<li>老师是对的我是错的</li>
<li>历史原因这两单位容易被不规范使用（混用、误用）</li>
<li><code>1 MB = 1000 KB = 1000*1000 B</code></li>
<li><code>1 MiB = 1024 KiB = 1024*1024 B</code></li>
</ol>
<h2 id="mbmegabyte">MB(megabyte)</h2>
<p><code>megabyte</code>是信息计量单位<code>byte</code>的倍数单位，多用于信息技术领域表示数据量<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。其前缀<code>mega</code>是<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/International_System_of_Units">国际单位制（International System of Units，SI）</a>规定的单位前缀，符号为<code>M</code>。因其换算关系为<code>10</code>的幂次，又被称为十进制前缀。</p>
<p>国际单位制由<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bipm.org/en/contact">国际计量局（Bureau international des poids et mesures，BIPM）</a>制定，查阅其官方网站和标准文档都有相关的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.bipm.org/en/measurement-units/si-prefixes">描述</a></p>
<blockquote>
<p>Decimal multiples and submultiples of SI units can be written using the SI prefixes listed below:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Name</th>
<th style="text-align: left;">Symbol</th>
<th style="text-align: left;">Multiplying factor</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">quetta</td>
<td style="text-align: left;">Q</td>
<td style="text-align: left;"><span class="math inline">\(10^{30}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">ronna</td>
<td style="text-align: left;">R</td>
<td style="text-align: left;"><span class="math inline">\(10^{27}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">yotta</td>
<td style="text-align: left;">Y</td>
<td style="text-align: left;"><span class="math inline">\(10^{24}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">zetta</td>
<td style="text-align: left;">Z</td>
<td style="text-align: left;"><span class="math inline">\(10^{21}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">exa</td>
<td style="text-align: left;">E</td>
<td style="text-align: left;"><span class="math inline">\(10^{18}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">peta</td>
<td style="text-align: left;">P</td>
<td style="text-align: left;"><span class="math inline">\(10^{15}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">tera</td>
<td style="text-align: left;">T</td>
<td style="text-align: left;"><span class="math inline">\(10^{12}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">giga</td>
<td style="text-align: left;">G</td>
<td style="text-align: left;"><span class="math inline">\(10^{9}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">mega</td>
<td style="text-align: left;">M</td>
<td style="text-align: left;"><span class="math inline">\(10^{6}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">kilo</td>
<td style="text-align: left;">k</td>
<td style="text-align: left;"><span class="math inline">\(10^{3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">hecto</td>
<td style="text-align: left;">h</td>
<td style="text-align: left;"><span class="math inline">\(10^{2}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">deca</td>
<td style="text-align: left;">da</td>
<td style="text-align: left;"><span class="math inline">\(10^{1}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">deci</td>
<td style="text-align: left;">d</td>
<td style="text-align: left;"><span class="math inline">\(10^{-1}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">centi</td>
<td style="text-align: left;">c</td>
<td style="text-align: left;"><span class="math inline">\(10^{-2}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">milli</td>
<td style="text-align: left;">m</td>
<td style="text-align: left;"><span class="math inline">\(10^{-3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">micro</td>
<td style="text-align: left;">µ</td>
<td style="text-align: left;"><span class="math inline">\(10^{-6}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">nano</td>
<td style="text-align: left;">n</td>
<td style="text-align: left;"><span class="math inline">\(10^{-9}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">pico</td>
<td style="text-align: left;">p</td>
<td style="text-align: left;"><span class="math inline">\(10^{-12}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">femto</td>
<td style="text-align: left;">f</td>
<td style="text-align: left;"><span class="math inline">\(10^{-15}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">atto</td>
<td style="text-align: left;">a</td>
<td style="text-align: left;"><span class="math inline">\(10^{-18}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">zepto</td>
<td style="text-align: left;">z</td>
<td style="text-align: left;"><span class="math inline">\(10^{-21}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">yocto</td>
<td style="text-align: left;">y</td>
<td style="text-align: left;"><span class="math inline">\(10^{-24}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ronto</td>
<td style="text-align: left;">r</td>
<td style="text-align: left;"><span class="math inline">\(10^{-27}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">quecto</td>
<td style="text-align: left;">q</td>
<td style="text-align: left;"><span class="math inline">\(10^{-30}\)</span></td>
</tr>
</tbody>
</table>
</blockquote>
<h2 id="mibmebibyte">MiB(mebibyte)</h2>
<p><code>mebibyte</code>同样是信息计量单位<code>byte</code>的倍数单位，其前缀<code>mebi</code>是<a target="_blank" rel="noopener external nofollow noreferrer" href="https://iec.ch/homepage">国际电工委员会（International Electrotechnical Commission，IEC）</a>规定的单位前缀，符号为<code>Mi</code>，由国际单位制（International System of Units，SI）的十进制单位前缀<code>mega</code>衍生而来，词源为<code>megabinary</code>。因其换算关系为<code>2</code>的幂次，又被称为二进制前缀。</p>
<p>该单位在 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/IEC_60027">IEC 60027-2</a> 标准中描述，该标准已被各国际组织广泛接受<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>，目前最新的版本是 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://webstore.iec.ch/publication/30633">IEC 60027-2:2019</a> 。IEC 最早在 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://webstore.iec.ch/publication/12253">IEC 60027-2:1972/AMD2:1999</a> 作出了明确定义并与国际单位制的十进制前缀区分。没有找到历史版本的文档可以下载，贴一个博客上看到的图<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>。另外该博主是在实际应用中发现的该问题，比较具有参考价值。</p>
<figure>
<img data-src="https://cdn.jsdelivr.net/gh/ChiuJun/img-hosting@main/img/202307192235190.jpg" alt="" /><figcaption>image-202307192235190</figcaption>
</figure>
<h2 id="mbpsmegabit-per-second">Mbps(megabit per second)</h2>
<p><code>megabit per second</code>与前两者不同，用于衡量数据传输速率，是<code>bit per second</code>的倍数单位。<code>Mbps</code>是其符号<code>Mbit/s</code>或<code>Mb/s</code>的常见缩写，其前缀<code>mega</code>同样是<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/International_System_of_Units">国际单位制（International System of Units，SI）</a>规定的单位前缀，符号为<code>M</code>。<code>bit per second</code>的符号是<code>bit/s</code>，是<code>bit</code>与<code>s</code>的导出单位，同样具有二进制前缀的版本<code>mebibit per second</code>，符号<code>Mibit/s</code>。</p>
<p>以下是摘自<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units">维基</a>的表格：</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">Name</th>
<th style="text-align: center;">Symbol</th>
<th style="text-align: center;">Multiple</th>
<th>Multiple</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Bit_rate">bit per second</a></td>
<td style="text-align: center;">bit/s</td>
<td style="text-align: center;">1</td>
<td>1</td>
</tr>
<tr class="even">
<td style="text-align: center;"></td>
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Metric_prefix">Metric prefixes</a> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/International_System_of_Units">SI</a>)</td>
<td style="text-align: center;"></td>
<td></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Kilobit_per_second">kilobit per second</a></td>
<td style="text-align: center;">kbit/s</td>
<td style="text-align: center;"><span class="math inline">\(10^{3}\)</span></td>
<td><span class="math inline">\(1000^{1}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Megabit_per_second">megabit per second</a></td>
<td style="text-align: center;">Mbit/s</td>
<td style="text-align: center;"><span class="math inline">\(10^{6}\)</span></td>
<td><span class="math inline">\(1000^{2}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Gigabit_per_second">gigabit per second</a></td>
<td style="text-align: center;">Gbit/s</td>
<td style="text-align: center;"><span class="math inline">\(10^{9}\)</span></td>
<td><span class="math inline">\(1000^{3}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Terabit_per_second">terabit per second</a></td>
<td style="text-align: center;">Tbit/s</td>
<td style="text-align: center;"><span class="math inline">\(10^{12}\)</span></td>
<td><span class="math inline">\(1000^{4}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"></td>
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Binary_prefix">Binary prefixes</a> (<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/ISO/IEC_80000">IEC 80000-13</a>)</td>
<td style="text-align: center;"></td>
<td></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Kilobit_per_second">kibibit per second</a></td>
<td style="text-align: center;">Kibit/s</td>
<td style="text-align: center;"><span class="math inline">\(2^{10}\)</span></td>
<td><span class="math inline">\(1024^{1}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Megabit_per_second">mebibit per second</a></td>
<td style="text-align: center;">Mibit/s</td>
<td style="text-align: center;"><span class="math inline">\(2^{20}\)</span></td>
<td><span class="math inline">\(1024^{2}\)</span></td>
</tr>
<tr class="even">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Gigabit_per_second">gibibit per second</a></td>
<td style="text-align: center;">Gibit/s</td>
<td style="text-align: center;"><span class="math inline">\(2^{30}\)</span></td>
<td><span class="math inline">\(1024^{3}\)</span></td>
</tr>
<tr class="odd">
<td style="text-align: center;"><a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Data-rate_units#Terabit_per_second">tebibit per second</a></td>
<td style="text-align: center;">Tibit/s</td>
<td style="text-align: center;"><span class="math inline">\(2^{40}\)</span></td>
<td><span class="math inline">\(1024^{4}\)</span></td>
</tr>
</tbody>
</table>
<h2 id="实际验证">实际验证</h2>
<p>以上是标准制定的理想情况，实际上由于标准制定晚于实际应用，这是一个历史遗留问题，有许多场合存在单位的错用混用情况。为了防止大家错用单位，其实 SI 标准文档里在其单位前缀的描述部分还作了相应提示：</p>
<blockquote>
<p>The SI prefixes refer strictly to powers of 10. They should not be used to indicate powers of 2 (for example, one kilobit represents 1000 bits and not 1024 bits).</p>
</blockquote>
<p>有趣的是大部分人印象中的<del><code>1 MB = 1024 KB = 1024*1024 B</code></del>并不只是来源于教科书，还来源于生活日常使用各种软件。例如微软的<code>Windows</code>操作系统，同一个文件拷贝到<code>macOS</code>操作系统后变大、<code>1TB</code>容量硬盘显示只有<code>930GB</code>容量，就是因为<code>Windows</code>使用的是十进制前缀的符号<code>TB</code>、<code>GB</code>、<code>MB</code>、<code>KB</code>，换算关系则是用的二进制前缀的 <span class="math inline">\(2^{40}\)</span>、<span class="math inline">\(2^{30}\)</span>、<span class="math inline">\(2^{20}\)</span>、<span class="math inline">\(2^{10}\)</span>。而硬盘厂商和<code>macOS</code>则规范使用了单位与换算关系，所以一直都是<del>巨硬</del>错了，而不是硬盘厂商或苹果的<code>macOS</code>。（虽然微软已经在修正这个历史遗留问题了</p>
<blockquote>
<p>有哪些事实没有一定计算机知识的人不会相信？ - Qi K的回答 - 知乎 https://www.zhihu.com/question/288115796/answer/523089229</p>
<p>非常意外地发现很多软粉在评论区疯狂地为微软洗地？？？</p>
<p>如果你要教育我说微软这样改不符合用户习惯，有兼容性问题等等等等，我建议你免开尊口，因为微软已经在改了。我举一个例子：</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.microsoft.com/en-us/windows/win32/api/shlwapi/nf-shlwapi-strformatbytesizea">StrFormatByteSizeA function (shlwapi.h) - Win32 apps</a></p>
<p>这是一个名叫StrFormatByteSizeA的Win32 API函数。它的作用是将字节数转换成以KB、MB结尾的字符串。这个函数的文档里有这么一句话：</p>
<blockquote>
<p>In Windows 10, size is reported in base 10 rather than base 2. For example, 1 KB is 1000 bytes rather than 1024.</p>
</blockquote>
<p>从Windows 10开始，这个函数返回的不再按照1024进位的方式转换，而是采用国际单位制（SI）的规则，返回1000进位转换后的结果。</p>
<p>说白了，微软并不认为一个小小的转换、一个简单的字符串会有什么兼容性问题，API这种最不应该改的东西说改就改了，其余的还不改无非就是懒得动弹，或者傲娇而已。</p>
</blockquote>
<p>博主顺道在<code>macOS Monterey 12.6.6</code>系统做了下验证：</p>
<p>首先查看<code>man-pages</code>描述</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$ man dd</span><br><span class="line"></span><br><span class="line">     bs=n     Set both input and output block size to n bytes, superseding the</span><br><span class="line">              ibs and obs operands.  If no conversion values other than noerror,</span><br><span class="line">              notrunc or sync are specified, then each input block is copied to</span><br><span class="line">              the output as a single block without any aggregation of short</span><br><span class="line">              blocks.</span><br><span class="line"></span><br><span class="line">     Where sizes or speed are specified, a decimal, octal, or hexadecimal number</span><br><span class="line">     of bytes is expected.  If the number ends with a “b”, “k”, “m”, “g”, “t”,</span><br><span class="line">     “p”, or “w”, the number is multiplied by 512, 1024 (1K), 1048576 (1M),</span><br><span class="line">     1073741824 (1G), 1099511627776 (1T), 1125899906842624 (1P) or the number of</span><br><span class="line">     bytes in an integer, respectively.  Two or more numbers may be separated by</span><br><span class="line">     an “x” to indicate a product.</span><br><span class="line"></span><br><span class="line">$ man ls</span><br><span class="line"></span><br><span class="line">     -h      When used with the -l option, use unit suffixes: Byte, Kilobyte,</span><br><span class="line">             Megabyte, Gigabyte, Terabyte and Petabyte in order to reduce the</span><br><span class="line">             number of digits to four or fewer using base 2 for sizes.  This</span><br><span class="line">             option is not defined in IEEE Std 1003.1-2008 (“POSIX.1”).</span><br></pre></td></tr></table></figure>
<p>生成相应字节数的文件后分别在终端和访达查看</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=1KiB.file bs=1k count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1024 bytes transferred <span class="keyword">in</span> 0.000066 secs (15515152 bytes/sec)</span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=1MiB.file bs=1m count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1048576 bytes transferred <span class="keyword">in</span> 0.000274 secs (3826919708 bytes/sec)</span><br><span class="line">$ <span class="built_in">dd</span> <span class="keyword">if</span>=/dev/zero of=1GiB.file bs=1g count=1</span><br><span class="line">1+0 records <span class="keyword">in</span></span><br><span class="line">1+0 records out</span><br><span class="line">1073741824 bytes transferred <span class="keyword">in</span> 0.747626 secs (1436201823 bytes/sec)</span><br><span class="line">$ <span class="built_in">ls</span> -lS  </span><br><span class="line">total 2099208</span><br><span class="line">-rw-r--r--  1 user  group  1073741824  7 12 22:48 1GiB.file</span><br><span class="line">-rw-r--r--  1 user  group     1048576  7 12 22:48 1MiB.file</span><br><span class="line">-rw-r--r--  1 user  group        1024  7 12 22:48 1KiB.file</span><br><span class="line">$ <span class="built_in">ls</span> -lhS</span><br><span class="line">total 2099208</span><br><span class="line">-rw-r--r--  1 user  group   1.0G  7 12 22:48 1GiB.file</span><br><span class="line">-rw-r--r--  1 user  group   1.0M  7 12 22:48 1MiB.file</span><br><span class="line">-rw-r--r--  1 user  group   1.0K  7 12 22:48 1KiB.file</span><br></pre></td></tr></table></figure>
<p>访达似乎对于小文件不愿意显示小数点后面的数字 <img data-src="https://cdn.jsdelivr.net/gh/ChiuJun/img-hosting@main/img/202307122304175.png" alt="image-20230712230405095" /></p>
<p>另外群晖的<code>DSM</code>操作系统里<code>1TB</code>硬盘和<code>Windows</code>一样也显示为<code>930GB</code>(<span class="math inline">\(10^9/2^{30}*10^3\)</span>)</p>
<figure>
<img data-src="https://cdn.jsdelivr.net/gh/ChiuJun/img-hosting@main/img/202307201240320.jpg" alt="" /><figcaption>image-202307201240320</figcaption>
</figure>
<p>说到这其实并没有完全的对与错，只需要在一些严肃的场合明确区分就没有问题了(o^^o)</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Wikimedia Foundation (2023) <em>Megabyte</em>, <em>Wikipedia</em>. Available at: https://en.wikipedia.org/wiki/Megabyte (Accessed: 18 July 2023).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Wikimedia Foundation (2023) <em>Megabyte</em>, <em>Wikipedia</em>. Available at: https://en.wikipedia.org/wiki/Megabyte (Accessed: 18 July 2023).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Wang, W. (2022) <em>1K bit = 1024 bit？</em>, <em>17哥</em>. Available at: https://wangwei1237.github.io/2022/06/19/Does-1Kbit-equal-1024bit/ (Accessed: 19 July 2023).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chiujun.github.io/posts/ba2ea806.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ChiuJun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ChiuJun's Blog">
      <meta itemprop="description" content="Personal Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ChiuJun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ba2ea806.html" class="post-title-link" itemprop="url">常见加密算法在Java中的使用</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-10 12:46:59" itemprop="dateCreated datePublished" datetime="2023-07-10T12:46:59+00:00">2023-07-10</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8F%82%E8%80%83%E4%B8%8E%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">参考与指南</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/posts/ba2ea806.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/ba2ea806.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.9k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>10 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>转载信息：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.aliyun.com/article/769289">面试官：说一下你常用的加密算法</a>（https://developer.aliyun.com/article/769289）<br />
原文作者：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.aliyun.com/profile/expert/bqscd3m22yfak">Java旅途</a>（https://developer.aliyun.com/profile/expert/bqscd3m22yfak）<br />
版权声明：本文内容由阿里云实名注册用户自发贡献，版权归原作者所有，阿里云开发者社区不拥有其著作权，亦不承担相应法律责任。具体规则请查看《<a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.aliyun.com/article/768092">阿里云开发者社区用户服务协议</a>》和《<a target="_blank" rel="noopener external nofollow noreferrer" href="https://developer.aliyun.com/article/768093">阿里云开发者社区知识产权保护指引</a>》。如果您发现本社区中有涉嫌抄袭的内容，填写<a target="_blank" rel="noopener external nofollow noreferrer" href="https://yida.alibaba-inc.com/o/right">侵权投诉表单</a>进行举报，一经查实，本社区将立刻删除涉嫌侵权内容。<br />
发表日期：2020年07月31日</p>
</blockquote>
<h2 id="转载注">转载注</h2>
<p>实际上<code>不可逆加密算法</code>与<code>可逆加密算法</code>这样的分类方式并不常见，文中所述的<code>不可逆加密算法</code>被称为<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Cryptographic_hash_function">密码散列函数（Cryptographic hash function）</a>，而 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/HMAC">HMAC(hash-based message authentication code)</a> 是一种<a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/Message_authentication_code">消息认证码（Message authentication code）</a> 需要使用密码散列函数（Cryptographic hash function）和自定义的密钥（secret key）计算得出。</p>
<hr />
<p>加密算法我们整体可以分为：可逆加密和不可逆加密，可逆加密又可以分为：对称加密和非对称加密。</p>
<h2 id="不可逆加密">不可逆加密</h2>
<p>常见的不可逆加密算法有<code>MD5</code>，<code>HMAC</code>，<code>SHA1</code>、<code>SHA-224</code>、<code>SHA-256</code>、<code>SHA-384</code>，和<code>SHA-512</code>，其中<code>SHA-224</code>、<code>SHA-256</code>、<code>SHA-384</code>，和<code>SHA-512</code>我们可以统称为<code>SHA2</code>加密算法，<code>SHA</code>加密算法的安全性要比<code>MD5</code>更高，而<code>SHA2</code>加密算法比<code>SHA1</code>的要高。其中<code>SHA</code>后面的数字表示的是加密后的字符串长度，<code>SHA1</code>默认会产生一个<code>160</code>位的信息摘要。</p>
<p>不可逆加密算法最大的特点就是密钥，但是<code>HMAC</code>是需要密钥的【手动狗头】。</p>
<p>由于这些加密都是不可逆的，因此比较常用的场景就是用户密码加密，其验证过程就是通过比较两个加密后的字符串是否一样来确认身份的。网上也有很多自称是可以破解<code>MD5</code>密码的网站，其原理也是一样，就是有一个巨大的资源库，存放了许多字符串及对应的<code>MD5</code>加密后的字符串，通过你输入的<code>MD5</code>加密串来进行比较，如果过你的密码复杂度比较低，还是有很大机率验证出来的。</p>
<h3 id="md5">MD5</h3>
<blockquote>
<p><strong>MD5信息摘要算法</strong>（英语：MD5 Message-Digest Algorithm），一种被广泛使用的密码散列函数，可以产生出一个128位（16字节）的散列值（hash value），用于确保信息传输完整一致。</p>
</blockquote>
<p><code>MD5</code>算法有以下特点：</p>
<p>1、压缩性：无论数据长度是多少，计算出来的<code>MD5</code>值长度相同</p>
<p>2、容易计算性：由原数据容易计算出<code>MD5</code>值</p>
<p>3、抗修改性：即便修改一个字节，计算出来的<code>MD5</code>值也会巨大差异</p>
<p>4、抗碰撞性：知道数据和<code>MD5</code>值，很小概率找到相同<code>MD5</code>值相同的原数据。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">md5</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        messageDigest = MessageDigest.getInstance(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] bytes = messageDigest.digest(text.getBytes());</span><br><span class="line">    <span class="keyword">return</span> Hex.encodeHexString(bytes); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="sha系列">SHA系列</h3>
<blockquote>
<p><strong>安全散列算法</strong>（英语：Secure Hash Algorithm，缩写为SHA）是一个密码散列函数家族，是FIPS所认证的安全散列算法。能计算出一个数字消息所对应到的，长度固定的字符串（又称消息摘要）的算法。且若输入的消息不同，它们对应到不同字符串的机率很高。</p>
<p>2005年8月17日的CRYPTO会议尾声中王小云、姚期智、姚储枫再度发表更有效率的SHA-1攻击法，能在2的63次方个计算复杂度内找到碰撞。</p>
</blockquote>
<p>也就是说<code>SHA-1</code>加密算法有碰撞的可能性，虽然很小。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">sha256</span><span class="params">(String text)</span> &#123;</span><br><span class="line">    <span class="type">MessageDigest</span> <span class="variable">messageDigest</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        messageDigest = MessageDigest.getInstance(<span class="string">&quot;SHA-256&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] bytes = messageDigest.digest(text.getBytes()); </span><br><span class="line">    <span class="keyword">return</span> Hex.encodeHexString(bytes); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="hmac系列">HMAC系列</h3>
<blockquote>
<p>HMAC是密钥相关的哈希运算消息认证码（Hash-based Message Authentication Code）的缩写，由H.Krawezyk，M.Bellare，R.Canetti于1996年提出的一种基于Hash函数和密钥进行消息认证的方法，并于1997年作为RFC2104被公布，并在<a target="_blank" rel="noopener external nofollow noreferrer" href="https://baike.baidu.com/item/IPSec/2472311">IPSec</a>和其他网络协议（如<a target="_blank" rel="noopener external nofollow noreferrer" href="https://baike.baidu.com/item/SSL/320778">SSL</a>）中得以广泛应用，现在已经成为事实上的Internet安全标准。它可以与任何迭代散列函数捆绑使用。</p>
<p>HMAC算法更像是一种加密算法，它引入了密钥，其安全性已经不完全依赖于所使用的Hash算法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">hmacSha256</span><span class="params">(String text, SecretKeySpec sk)</span> &#123;</span><br><span class="line">    <span class="type">Mac</span> <span class="variable">mac</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mac = Mac.getInstance(<span class="string">&quot;HmacSHA256&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        mac.init(sk);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InvalidKeyException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="type">byte</span>[] rawHmac = mac.doFinal(text.getBytes());</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(rawHmac));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果要使用不可逆加密，推荐使用SHA256、SHA384、SHA512以及HMAC-SHA256、HMAC-SHA384、HMAC-SHA512这几种算法。</p>
<h2 id="对称加密算法">对称加密算法</h2>
<p>对称加密算法是应用比较早的算法，在数据加密和解密的时用的都是同一个密钥，这就造成了密钥管理困难的问题。常见的对称加密算法有<code>DES</code>、<code>3DES</code>、<code>AES128</code>、<code>AES192</code>、<code>AES256</code> (默认安装的 <code>JDK</code> 尚不支持 <code>AES256</code>，需要安装对应的 <code>jce</code> 补丁进行升级 <code>jce1.7</code>，<code>jce1.8</code>)。其中<code>AES</code>后面的数字代表的是密钥长度。对称加密算法的安全性相对较低，比较适用的场景就是内网环境中的加解密。</p>
<h3 id="des">DES</h3>
<p><code>DES</code>是对称加密算法领域中的典型算法，其密钥默认长度为<code>56</code>位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 加密</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(<span class="type">byte</span>[] dataSource, String password)</span>&#123;</span><br><span class="line">     <span class="keyword">try</span> &#123;</span><br><span class="line">         <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>();</span><br><span class="line">         <span class="type">DESKeySpec</span> <span class="variable">desKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESKeySpec</span>(password.getBytes());</span><br><span class="line">         <span class="comment">//创建一个密匙工厂，然后用它把DESKeySpec转换成 </span></span><br><span class="line">         <span class="type">SecretKeyFactory</span> <span class="variable">secretKeyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DES&quot;</span>); </span><br><span class="line">         <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> secretKeyFactory.generateSecret(desKeySpec); </span><br><span class="line">         <span class="comment">//Cipher对象实际完成加密操作 </span></span><br><span class="line">         <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>); </span><br><span class="line">         <span class="comment">//用密匙初始化Cipher对象 </span></span><br><span class="line">         cipher.init(Cipher.ENCRYPT_MODE, secretKey, random); </span><br><span class="line">         <span class="comment">//正式执行加密操作 </span></span><br><span class="line">         <span class="keyword">return</span> Base64.encodeBase64String(cipher.doFinal(dataSource)); </span><br><span class="line">     &#125; <span class="keyword">catch</span> (Throwable e) &#123; </span><br><span class="line">         e.printStackTrace(); </span><br><span class="line">     &#125; <span class="keyword">return</span> <span class="literal">null</span>; </span><br><span class="line"> &#125; </span><br><span class="line"><span class="comment">// 解密</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String src, String password)</span> <span class="keyword">throws</span> Exception&#123; </span><br><span class="line">    <span class="comment">// DES算法要求有一个可信任的随机数源 </span></span><br><span class="line">    <span class="type">SecureRandom</span> <span class="variable">random</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecureRandom</span>(); </span><br><span class="line">    <span class="comment">// 创建一个DESKeySpec对象 </span></span><br><span class="line">    <span class="type">DESKeySpec</span> <span class="variable">desKeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESKeySpec</span>(password.getBytes()); </span><br><span class="line">    <span class="comment">// 创建一个密匙工厂 </span></span><br><span class="line">    <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DES&quot;</span>); </span><br><span class="line">    <span class="comment">// 将DESKeySpec对象转换成SecretKey对象 </span></span><br><span class="line">    <span class="type">SecretKey</span> <span class="variable">secretKey</span> <span class="operator">=</span> keyFactory.generateSecret(desKeySpec); </span><br><span class="line">    <span class="comment">// Cipher对象实际完成解密操作 </span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DES&quot;</span>); </span><br><span class="line">    <span class="comment">// 用密匙初始化Cipher对象 </span></span><br><span class="line">    cipher.init(Cipher.DECRYPT_MODE, secretKey, random); </span><br><span class="line">    <span class="comment">// 真正开始解密操作 </span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(cipher.doFinal(Base64.decodeBase64(src))); </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="des-1">3DES</h3>
<p><code>3DES</code>（即Triple DES）是<code>DES</code>向<code>AES</code>过渡的加密算法，它使用3条56位的密钥对数据进行三次加密。是<code>DES</code>的一个更安全的变形。它以<code>DES</code>为基本模块，通过组合分组方法设计出分组加密算法。比起最初的<code>DES</code>，<code>3DES</code>更为安全。密钥长度默认为<code>168</code>位，还可以选择<code>128</code>位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encryptThreeDESECB</span><span class="params">(String src, String key)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        <span class="type">DESedeKeySpec</span> <span class="variable">dks</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESedeKeySpec</span>(key.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DESede&quot;</span>);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">securekey</span> <span class="operator">=</span> keyFactory.generateSecret(dks);</span><br><span class="line"></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DESede/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.ENCRYPT_MODE, securekey);</span><br><span class="line">        <span class="type">byte</span>[] b = cipher.doFinal(src.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="type">String</span> <span class="variable">ss</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(b));</span><br><span class="line">        ss = ss.replaceAll(<span class="string">&quot;\\+&quot;</span>, <span class="string">&quot;-&quot;</span>);</span><br><span class="line">        ss = ss.replaceAll(<span class="string">&quot;/&quot;</span>, <span class="string">&quot;_&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> ss;</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decryptThreeDESECB</span><span class="params">(String src, String key)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span>&#123;</span><br><span class="line">        src = src.replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;+&quot;</span>);</span><br><span class="line">        src = src.replaceAll(<span class="string">&quot;_&quot;</span>, <span class="string">&quot;/&quot;</span>);</span><br><span class="line">        <span class="type">byte</span>[] bytesrc = Base64.decodeBase64(src.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="comment">// --解密的key</span></span><br><span class="line">        <span class="type">DESedeKeySpec</span> <span class="variable">dks</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">DESedeKeySpec</span>(key.getBytes(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">        <span class="type">SecretKeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> SecretKeyFactory.getInstance(<span class="string">&quot;DESede&quot;</span>);</span><br><span class="line">        <span class="type">SecretKey</span> <span class="variable">securekey</span> <span class="operator">=</span> keyFactory.generateSecret(dks);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// --Chipher对象解密</span></span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(<span class="string">&quot;DESede/ECB/PKCS5Padding&quot;</span>);</span><br><span class="line">        cipher.init(Cipher.DECRYPT_MODE, securekey);</span><br><span class="line">        <span class="type">byte</span>[] retByte = cipher.doFinal(bytesrc);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(retByte, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span>(Exception ex)&#123;</span><br><span class="line">        ex.printStackTrace();</span><br><span class="line">        <span class="keyword">return</span> src;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="aes">AES</h3>
<p><code>AES</code> 高级数据加密标准，能够有效抵御已知的针对<code>DES</code>算法的所有攻击，默认密钥长度为<code>128</code>位，还可以供选择<code>192</code>位，<code>256</code>位。这里顺便提一句这个位指的是bit。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">defaultCharset</span> <span class="operator">=</span> <span class="string">&quot;UTF-8&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_AES</span> <span class="operator">=</span> <span class="string">&quot;AES&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_MD5</span> <span class="operator">=</span> <span class="string">&quot;MD5&quot;</span>;</span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> MessageDigest md5Digest;</span><br><span class="line"><span class="keyword">static</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        md5Digest = MessageDigest.getInstance(KEY_MD5);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (NoSuchAlgorithmException e) &#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 加密</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">encrypt</span><span class="params">(String data, String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doAES(data, key, Cipher.ENCRYPT_MODE);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 解密</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">decrypt</span><span class="params">(String data, String key)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> doAES(data, key, Cipher.DECRYPT_MODE);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 加解密</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> String <span class="title function_">doAES</span><span class="params">(String data, String key, <span class="type">int</span> mode)</span> &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">boolean</span> <span class="variable">encrypt</span> <span class="operator">=</span> mode == Cipher.ENCRYPT_MODE;</span><br><span class="line">        <span class="type">byte</span>[] content;</span><br><span class="line">        <span class="keyword">if</span> (encrypt) &#123;</span><br><span class="line">            content = data.getBytes(defaultCharset);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            content = Base64.decodeBase64(data.getBytes());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">SecretKeySpec</span> <span class="variable">keySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SecretKeySpec</span>(md5Digest.digest(key.getBytes(defaultCharset))</span><br><span class="line">                                                  , KEY_AES);</span><br><span class="line">        <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(KEY_AES);<span class="comment">// 创建密码器</span></span><br><span class="line">        cipher.init(mode, keySpec);<span class="comment">// 初始化</span></span><br><span class="line">        <span class="type">byte</span>[] result = cipher.doFinal(content);</span><br><span class="line">        <span class="keyword">if</span> (encrypt) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(Base64.encodeBase64(result));</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">String</span>(result, defaultCharset);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>推荐使用对称加密算法有：<code>AES128</code>、<code>AES192</code>、<code>AES256</code>。</p>
<h2 id="非对称加密算法">非对称加密算法</h2>
<p>非对称加密算法有两个密钥，这两个密钥完全不同但又完全匹配。只有使用匹配的一对公钥和私钥，才能完成对明文的加密和解密过程。常见的非对称加密有<code>RSA</code>、<code>SM2</code>等。</p>
<h3 id="rsa">RSA</h3>
<p><code>RSA</code>密钥至少为500位长，一般推荐使用1024位。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//非对称密钥算法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">KEY_ALGORITHM</span> <span class="operator">=</span> <span class="string">&quot;RSA&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 密钥长度，DH算法的默认密钥长度是1024</span></span><br><span class="line"><span class="comment">  * 密钥长度必须是64的倍数，在512到65536位之间</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">KEY_SIZE</span> <span class="operator">=</span> <span class="number">1024</span>;</span><br><span class="line"><span class="comment">//公钥</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PUBLIC_KEY</span> <span class="operator">=</span> <span class="string">&quot;RSAPublicKey&quot;</span>;</span><br><span class="line"><span class="comment">//私钥</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">String</span> <span class="variable">PRIVATE_KEY</span> <span class="operator">=</span> <span class="string">&quot;RSAPrivateKey&quot;</span>;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 初始化密钥对</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> Map 甲方密钥的Map</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Map&lt;String, Object&gt; <span class="title function_">initKey</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//实例化密钥生成器</span></span><br><span class="line">    <span class="type">KeyPairGenerator</span> <span class="variable">keyPairGenerator</span> <span class="operator">=</span> KeyPairGenerator.getInstance(KEY_ALGORITHM);</span><br><span class="line">    <span class="comment">//初始化密钥生成器</span></span><br><span class="line">    keyPairGenerator.initialize(KEY_SIZE);</span><br><span class="line">    <span class="comment">//生成密钥对</span></span><br><span class="line">    <span class="type">KeyPair</span> <span class="variable">keyPair</span> <span class="operator">=</span> keyPairGenerator.generateKeyPair();</span><br><span class="line">    <span class="comment">//甲方公钥</span></span><br><span class="line">    <span class="type">RSAPublicKey</span> <span class="variable">publicKey</span> <span class="operator">=</span> (RSAPublicKey) keyPair.getPublic();</span><br><span class="line">    <span class="comment">//甲方私钥</span></span><br><span class="line">    <span class="type">RSAPrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> (RSAPrivateKey) keyPair.getPrivate();</span><br><span class="line">    <span class="comment">//将密钥存储在map中</span></span><br><span class="line">    Map&lt;String, Object&gt; keyMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;String, Object&gt;();</span><br><span class="line">    keyMap.put(PUBLIC_KEY, publicKey);</span><br><span class="line">    keyMap.put(PRIVATE_KEY, privateKey);</span><br><span class="line">    <span class="keyword">return</span> keyMap;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 私钥加密</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data 待加密数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> key  密钥</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 加密数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encryptByPrivateKey(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//取得私钥</span></span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">pkcs8KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(key);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(KEY_ALGORITHM);</span><br><span class="line">    <span class="comment">//生成私钥</span></span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyFactory.generatePrivate(pkcs8KeySpec);</span><br><span class="line">    <span class="comment">//数据加密</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">    cipher.init(Cipher.ENCRYPT_MODE, privateKey);</span><br><span class="line">    <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 公钥加密</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data 待加密数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> key  密钥</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 加密数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] encryptByPublicKey(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实例化密钥工厂</span></span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(KEY_ALGORITHM);</span><br><span class="line">    <span class="comment">//初始化公钥</span></span><br><span class="line">    <span class="comment">//密钥材料转换</span></span><br><span class="line">    <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(key);</span><br><span class="line">    <span class="comment">//产生公钥</span></span><br><span class="line">    <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">    <span class="comment">//数据加密</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">    cipher.init(Cipher.ENCRYPT_MODE, pubKey);</span><br><span class="line">    <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 私钥解密</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data 待解密数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> key  密钥</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 解密数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decryptByPrivateKey(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="comment">//取得私钥</span></span><br><span class="line">    <span class="type">PKCS8EncodedKeySpec</span> <span class="variable">pkcs8KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PKCS8EncodedKeySpec</span>(key);</span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(KEY_ALGORITHM);</span><br><span class="line">    <span class="comment">//生成私钥</span></span><br><span class="line">    <span class="type">PrivateKey</span> <span class="variable">privateKey</span> <span class="operator">=</span> keyFactory.generatePrivate(pkcs8KeySpec);</span><br><span class="line">    <span class="comment">//数据解密</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">    cipher.init(Cipher.DECRYPT_MODE, privateKey);</span><br><span class="line">    <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 公钥解密</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> data 待解密数据</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> key  密钥</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 解密数据</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] decryptByPublicKey(<span class="type">byte</span>[] data, <span class="type">byte</span>[] key) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//实例化密钥工厂</span></span><br><span class="line">    <span class="type">KeyFactory</span> <span class="variable">keyFactory</span> <span class="operator">=</span> KeyFactory.getInstance(KEY_ALGORITHM);</span><br><span class="line">    <span class="comment">//初始化公钥</span></span><br><span class="line">    <span class="comment">//密钥材料转换</span></span><br><span class="line">    <span class="type">X509EncodedKeySpec</span> <span class="variable">x509KeySpec</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">X509EncodedKeySpec</span>(key);</span><br><span class="line">    <span class="comment">//产生公钥</span></span><br><span class="line">    <span class="type">PublicKey</span> <span class="variable">pubKey</span> <span class="operator">=</span> keyFactory.generatePublic(x509KeySpec);</span><br><span class="line">    <span class="comment">//数据解密</span></span><br><span class="line">    <span class="type">Cipher</span> <span class="variable">cipher</span> <span class="operator">=</span> Cipher.getInstance(keyFactory.getAlgorithm());</span><br><span class="line">    cipher.init(Cipher.DECRYPT_MODE, pubKey);</span><br><span class="line">    <span class="keyword">return</span> cipher.doFinal(data);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 取得私钥</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> keyMap 密钥map</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 私钥</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getPrivateKey(Map&lt;String, Object&gt; keyMap) &#123;</span><br><span class="line">    <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> (Key) keyMap.get(PRIVATE_KEY);</span><br><span class="line">    <span class="keyword">return</span> key.getEncoded();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * 取得公钥</span></span><br><span class="line"><span class="comment">  *</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@param</span> keyMap 密钥map</span></span><br><span class="line"><span class="comment">  * <span class="doctag">@return</span> byte[] 公钥</span></span><br><span class="line"><span class="comment">  */</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="type">byte</span>[] getPublicKey(Map&lt;String, Object&gt; keyMap) <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">    <span class="type">Key</span> <span class="variable">key</span> <span class="operator">=</span> (Key) keyMap.get(PUBLIC_KEY);</span><br><span class="line">    <span class="keyword">return</span> key.getEncoded();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="加密盐">加密盐</h2>
<p>加密盐也是比较常听到的一个概念，盐就是一个随机字符串用来和我们的加密串拼接后进行加密。加盐主要是为了提供加密字符串的安全性。假如有一个加盐后的加密串，黑客通过一定手段这个加密串，他拿到的明文，并不是我们加密前的字符串，而是加密前的字符串和盐组合的字符串，这样相对来说又增加了字符串的安全性。</p>
<p><strong>文中的一些算法来源于网络，可直接复制使用</strong>。</p>
<p>比较推荐的几个加密算法有：</p>
<ul>
<li>不可逆加密：<code>SHA256</code>、<code>SHA384</code>、<code>SHA512</code>以及<code>HMAC-SHA256</code>、<code>HMAC-SHA384</code>、<code>HMAC-SHA512</code></li>
<li>对称加密算法：<code>AES</code>、<code>3DES</code></li>
<li>非对称加密算法：<code>RSA</code></li>
</ul>
<figure>
<img data-src="https://img2020.cnblogs.com/blog/1719198/202007/1719198-20200731091157790-1639133777.jpg" alt="" /><figcaption>img</figcaption>
</figure>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chiujun.github.io/posts/6f0712da.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ChiuJun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ChiuJun's Blog">
      <meta itemprop="description" content="Personal Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ChiuJun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/6f0712da.html" class="post-title-link" itemprop="url">一键部署 Hexo 博客到 GitHub Pages</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-07 22:08:13" itemprop="dateCreated datePublished" datetime="2023-07-07T22:08:13+00:00">2023-07-07</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-09 17:34:44" itemprop="dateModified" datetime="2023-07-09T17:34:44+00:00">2023-07-09</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8F%82%E8%80%83%E4%B8%8E%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">参考与指南</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/posts/6f0712da.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/6f0712da.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.8k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>7 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/">Hexo</a> 是一个快速、简洁且高效的博客框架，只需一条指令即可部署到 GitHub Pages, Heroku 或其他平台<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a>。</p>
<p>如果没有什么特殊的需求，将生成的静态网页托管到 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pages.github.com/">GitHub Pages</a> 是一个不错的选择。目前 Hexo 官方提供了2种方式一键部署到 GitHub Pages：</p>
<ul>
<li>本地一键部署：使用 Hexo 官方的部署插件 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/hexojs/hexo-deployer-git">hexo-deployer-git</a></li>
<li>远程一键部署：使用 GitHub 自家的 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/CI/CD">CI/CD</a> 工具 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.github.com/zh/actions">GitHub Actions</a></li>
</ul>
<p>这两种方式对应了不同的使用场景，第一种方式适合博客源代码没有托管在 GitHub 的场景，第二种相反。博主选择了将博客源代码托管到了 GitHub，所以很自然的选择了第二种方式实现一键部署的需求，接下来具体看看如何利用 CI/CD 工具实现远程一键部署 Hexo 博客到 GitHub Pages。</p>
<h2 id="一键部署博客">一键部署博客</h2>
<p>博主在几年前就接触了 Hexo 博客，当时 GitHub Actions 的正式版才推出不久(2019/11/13)<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a>，参考了<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/formulahendry">韩骏</a>大佬的博客<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a>使用了 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.appveyor.com/">AppVeyor</a> 作为 CI/CD 工具，只可惜其免费版本不支持私有仓库。博客源代码仓库包含了非公开的配置信息(服务的<code>token</code>、<code>secret</code>)以及加密文章的原文、草稿箱的草稿，因此源代码仓库设置为私有是必要的。而 GitHub Actions 作为 GitHub 自家的产品，对于当前的使用场景即使是私有仓库也完美支持。有一点需要注意的是对于私有仓库 GitHub Actions 有额度限制，不过即使是最低级别的 GitHub Free 也有相当可观的额度，具体可以查阅<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.github.com/en/billing/managing-billing-for-github-actions/about-billing-for-github-actions">官方文档</a>。</p>
<p>选定 GitHub Actions 作为 CI/CD 工具后查阅 Hexo 官方给定的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/docs/github-pages">文档</a>发现其设定是博客源代码与 GitHub Pages 储存在同一个仓库通过分支进行区分，但将 GitHub Pages 所在的仓库设置为私有需要订阅更高级别的产品<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a>，这显然与我们的需求不符。</p>
<blockquote>
<p>GitHub Pages is available in public repositories with GitHub Free and GitHub Free for organizations, and in public and private repositories with GitHub Pro, GitHub Team, GitHub Enterprise Cloud, and GitHub Enterprise Server. For more information, see "<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.github.com/en/get-started/learning-about-github/githubs-products">GitHub’s products</a>."</p>
</blockquote>
<p>通过查阅 Hexo 官方配置文件中复用的 Action <code>peaceiris/actions-gh-pages@v3</code>的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/marketplace/actions/github-pages-action">文档</a>发现，经过简单配置和修改就可以实现我们的需求。</p>
<blockquote>
<p>By default, your files are published to the repository which is running this action. If you want to publish to another repository on GitHub, set the environment variable <code>external_repository</code> to <code>&lt;username&gt;/&lt;external-repository&gt;</code>.</p>
</blockquote>
<p>先分别贴上原版的配置文件和修改后的配置文件：</p>
<ul>
<li><p>原版配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Pages</span></span><br><span class="line"></span><br><span class="line"><span class="attr">on:</span></span><br><span class="line">  <span class="attr">push:</span></span><br><span class="line">    <span class="attr">branches:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="string">main</span>  <span class="comment"># default branch</span></span><br><span class="line"></span><br><span class="line"><span class="attr">jobs:</span></span><br><span class="line">  <span class="attr">pages:</span></span><br><span class="line">    <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">    <span class="attr">permissions:</span></span><br><span class="line">      <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line">    <span class="attr">steps:</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="comment"># If your repository depends on submodule, please see: https://github.com/actions/checkout</span></span><br><span class="line">          <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">16.</span><span class="string">x</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">node-version:</span> <span class="string">&#x27;16&#x27;</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">NPM</span> <span class="string">dependencies</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">actions/cache@v2</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">          <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-npm-cache</span></span><br><span class="line">          <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">            $&#123;&#123; runner.OS &#125;&#125;-npm-cache</span></span><br><span class="line"><span class="string"></span>      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">        <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">      <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">        <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">        <span class="attr">with:</span></span><br><span class="line">          <span class="attr">github_token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">          <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br></pre></td></tr></table></figure></li>
<li><p>修改后的配置文件</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">Deploy</span> <span class="string">GitHub</span> <span class="string">Pages</span></span><br><span class="line"> </span><br><span class="line"> <span class="attr">on:</span></span><br><span class="line">   <span class="attr">push:</span></span><br><span class="line">     <span class="attr">branches:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="string">main</span>  <span class="comment"># default branch</span></span><br><span class="line"> </span><br><span class="line"> <span class="attr">jobs:</span></span><br><span class="line">   <span class="attr">deploy-gh-pages:</span></span><br><span class="line">     <span class="attr">runs-on:</span> <span class="string">ubuntu-latest</span></span><br><span class="line">     <span class="attr">permissions:</span></span><br><span class="line">       <span class="attr">contents:</span> <span class="string">write</span></span><br><span class="line">     <span class="attr">steps:</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">uses:</span> <span class="string">actions/checkout@v3</span></span><br><span class="line">         <span class="attr">with:</span></span><br><span class="line">           <span class="attr">token:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.GITHUB_TOKEN</span> <span class="string">&#125;&#125;</span></span><br><span class="line">           <span class="comment"># If your repository depends on submodule, please see: https://github.com/actions/checkout</span></span><br><span class="line">           <span class="attr">submodules:</span> <span class="string">recursive</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">pandoc</span></span><br><span class="line">         <span class="attr">run:</span> <span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">pandoc</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">19.</span><span class="string">x</span></span><br><span class="line">         <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">         <span class="attr">with:</span></span><br><span class="line">           <span class="attr">node-version:</span> <span class="string">&#x27;19&#x27;</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Cache</span> <span class="string">NPM</span> <span class="string">dependencies</span></span><br><span class="line">         <span class="attr">uses:</span> <span class="string">actions/cache@v2</span></span><br><span class="line">         <span class="attr">with:</span></span><br><span class="line">           <span class="attr">path:</span> <span class="string">node_modules</span></span><br><span class="line">           <span class="attr">key:</span> <span class="string">$&#123;&#123;</span> <span class="string">runner.OS</span> <span class="string">&#125;&#125;-npm-cache</span></span><br><span class="line">           <span class="attr">restore-keys:</span> <span class="string">|</span></span><br><span class="line"><span class="string">             $&#123;&#123; runner.OS &#125;&#125;-npm-cache</span></span><br><span class="line"><span class="string"></span>       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">Dependencies</span></span><br><span class="line">         <span class="attr">run:</span> <span class="string">npm</span> <span class="string">install</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Build</span></span><br><span class="line">         <span class="attr">run:</span> <span class="string">npm</span> <span class="string">run</span> <span class="string">build</span></span><br><span class="line">       <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">         <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">         <span class="attr">with:</span></span><br><span class="line">           <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACTIONS_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">           <span class="attr">external_repository:</span> <span class="string">username/external-repository</span></span><br><span class="line">           <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br><span class="line">           <span class="attr">user_name:</span> <span class="string">&#x27;github-actions[bot]&#x27;</span></span><br><span class="line">           <span class="attr">user_email:</span> <span class="string">&#x27;github-actions[bot]@users.noreply.github.com&#x27;</span></span><br><span class="line">           <span class="attr">commit_message:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.head_commit.message</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<p>与原版的配置文件对比只修改了以下3个方面：</p>
<ol type="1">
<li>安装 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://pandoc.org/">pandoc</a> ： <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 19</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Install</span> <span class="string">pandoc</span></span><br><span class="line">  <span class="attr">run:</span> <span class="string">sudo</span> <span class="string">apt-get</span> <span class="string">install</span> <span class="string">pandoc</span></span><br></pre></td></tr></table></figure>
<ul>
<li>与此文无关，因渲染器改为了<code>hexo-renderer-pandoc</code></li>
</ul></li>
<li>修改 Node.js 主版本： <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 21</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Use</span> <span class="string">Node.js</span> <span class="number">19.</span><span class="string">x</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">actions/setup-node@v2</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">node-version:</span> <span class="string">&#x27;19&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>在本地使用<code>node --version</code>查看即可</li>
</ul></li>
<li>配置<code>peaceiris/actions-gh-pages@v3</code>的传入参数： <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># line 36</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">Deploy</span></span><br><span class="line">  <span class="attr">uses:</span> <span class="string">peaceiris/actions-gh-pages@v3</span></span><br><span class="line">  <span class="attr">with:</span></span><br><span class="line">    <span class="attr">deploy_key:</span> <span class="string">$&#123;&#123;</span> <span class="string">secrets.ACTIONS_DEPLOY_KEY</span> <span class="string">&#125;&#125;</span></span><br><span class="line">    <span class="attr">external_repository:</span> <span class="string">username/external-repository</span></span><br><span class="line">    <span class="attr">publish_dir:</span> <span class="string">./public</span></span><br><span class="line">    <span class="attr">user_name:</span> <span class="string">&#x27;github-actions[bot]&#x27;</span></span><br><span class="line">    <span class="attr">user_email:</span> <span class="string">&#x27;github-actions[bot]@users.noreply.github.com&#x27;</span></span><br><span class="line">    <span class="attr">commit_message:</span> <span class="string">$&#123;&#123;</span> <span class="string">github.event.head_commit.message</span> <span class="string">&#125;&#125;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>删除<code>github_token</code>：对于<code>external_repository</code>使用<code>external_repository</code>或<code>personal_token</code>代替</li>
<li>增加<code>deploy_key</code>：生成<code>SSH Key Pair</code>，在 GitHub Pages 仓库使用公钥设置<code>Deploy keys</code>并确保勾选<code>Allow write access</code>，在博客源代码仓库的<code>Actions secrets and variables</code>设置项使用私钥设置<code>Secrets</code>。配置文件里的<code>ACTIONS_DEPLOY_KEY</code>就是之前设置<code>Secrets</code>填的名字</li>
<li>增加<code>external_repository</code>：GitHub Pages 仓库<code>username/external-repository</code></li>
<li>增加<code>user_name</code>：配置 GitHub Pages 仓库的 commit 用户为<code>github-actions[bot]</code></li>
<li>增加<code>user_email</code>：配置 GitHub Pages 仓库的 commit 用户邮箱为<code>github-actions[bot]</code>邮箱</li>
<li>增加<code>commit_message</code>：配置 GitHub Pages 仓库的 commit message 为触发该 GitHub Actions 事件源的头部 commit message</li>
</ul></li>
</ol>
<p>修改完配置文件后将配置文件存放到博客源代码仓库的<code>.github/workflows/filename.yml</code>，以后有提交 push 到该仓库的<code>main</code>分支便可触发该配置文件对应的工作流完成 GitHub Pages 的自动部署。</p>
<h2 id="一键推送源码">一键推送源码</h2>
<p>至此似乎已经大功告成，但博主觉得已经完成建站进入正常更新状态的博客，每次更新还需要<code>git add</code>、<code>git commit</code>、<code>git push</code>三个步骤才能完成博客更新还是略微麻烦，有没有办法能实现一键推送博客源代码？</p>
<h3 id="使用-hexo-deployer">使用 Hexo Deployer</h3>
<p><code>Hexo Deployer</code>是 Hexo 自带的部署工具，通过编写安装各种各样的 Hexo 插件，可以通过<code>hexo deploy</code>命令将 Hexo 博客一键部署到各种类型的托管服务，<code>Hexo Deployer</code>提供了 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://hexo.io/zh-cn/api/deployer">API</a> 供开发者开发第三方插件实现该功能。</p>
<p>虽然 Hexo 官方的本意是部署博客，但似乎可以借助这个功能实现我们一键推送源码的需求，于是博主根据 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/hexojs/hexo-deployer-git">hexo-deployer-git</a> 编写了一个 Hexo 插件 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ChiuJun/hexo-auto-push-git">hexo-auto-push-git</a> ：</p>
<ol type="1">
<li><p>安装</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install https://github.com/ChiuJun/hexo-auto-push-git.git --save-dev</span><br></pre></td></tr></table></figure></p></li>
<li><p>配置</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># You can use this:</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line">  <span class="attr">type:</span> <span class="string">git</span></span><br><span class="line">  <span class="attr">branch:</span> [<span class="string">branch</span>]</span><br><span class="line">  <span class="attr">message:</span> [<span class="string">message</span>]</span><br></pre></td></tr></table></figure></li>
<li><p>使用</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo deploy</span><br></pre></td></tr></table></figure></p></li>
</ol>
<h3 id="使用-alias-shell">使用 alias shell</h3>
<p>修改完博客配置希望看看效果，每次都要输入一串命令</p>
<p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexo clean &amp;&amp; hexo g &amp;&amp; hexo s</span><br></pre></td></tr></table></figure></p>
<p>想到可以用<code>alias</code>简化操作，突然想到<code>alias</code>也可以完成我们一键推送源码的需求</p>
<p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">alias hexo_test=&quot;hexo clean &amp;&amp; hexo generate &amp;&amp; hexo server&quot;</span><br><span class="line">alias hexot=hexo_test</span><br><span class="line">alias hexo_post_article_to_source_repo=&quot;git add -A &amp;&amp; git commit -m \&quot;docs: site updated `date \&quot;+%Y-%m-%d %H:%M:%S\&quot;`\&quot; &amp;&amp; git push -u origin HEAD:main&quot;</span><br><span class="line">alias hexop=hexo_post_article_to_source_repo</span><br></pre></td></tr></table></figure></p>
<p>将后面两行<code>alias</code>命令添加到所使用 shell 的配置文件中，使用<code>source</code>命令更新下配置文件便可以使用别名<code>hexop</code>一键推送源码 <figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ hexop</span><br></pre></td></tr></table></figure> 至此，我们已经完成了一键推送源码以及一键部署博客，以后便可以愉快的写博客了！</p>
<section class="footnotes" role="doc-endnotes">
<hr />
<ol>
<li id="fn1" role="doc-endnote"><p>Hexo (2023a) <em>Home page</em> , <em>Hexo</em>. Available at: https://hexo.io/zh-cn/ (Accessed: 08 July 2023).<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2" role="doc-endnote"><p>Niyogi, S. (2019) <em>New from universe 2019: Github for mobile, GitHub Archive Program, and more</em>, <em>The GitHub Blog</em>. Available at: https://github.blog/2019-11-13-universe-day-one/#github-actions (Accessed: 08 July 2023).<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3" role="doc-endnote"><p>Han, J. (2017) <em>Hexo的版本控制与持续集成</em>, <em>formulahendry</em>. Available at: https://formulahendry.github.io/2016/12/04/hexo-ci/ (Accessed: 08 July 2023).<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4" role="doc-endnote"><p>GitHub, Inc. (no date) <em>About GitHub Pages</em>, <em>GitHub Docs</em>. Available at: https://docs.github.com/en/pages/getting-started-with-github-pages/about-github-pages (Accessed: 09 July 2023).<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>




    


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="">
    <link itemprop="mainEntityOfPage" href="https://chiujun.github.io/posts/ad81da89.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="ChiuJun">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="ChiuJun's Blog">
      <meta itemprop="description" content="Personal Blog">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="undefined | ChiuJun's Blog">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          <a href="/posts/ad81da89.html" class="post-title-link" itemprop="url">Commit message 和 Change log 编写指南</a>
        </h2>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2023-07-05 21:57:20" itemprop="dateCreated datePublished" datetime="2023-07-05T21:57:20+00:00">2023-07-05</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2023-07-06 23:33:53" itemprop="dateModified" datetime="2023-07-06T23:33:53+00:00">2023-07-06</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E5%8F%82%E8%80%83%E4%B8%8E%E6%8C%87%E5%8D%97/" itemprop="url" rel="index"><span itemprop="name">参考与指南</span></a>
        </span>
    </span>

  
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Disqus：</span>
    
    <a title="disqus" href="/posts/ad81da89.html#disqus_thread" itemprop="discussionUrl">
      <span class="post-comments-count disqus-comment-count" data-disqus-identifier="posts/ad81da89.html" itemprop="commentCount"></span>
    </a>
  </span>
  
  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>1.6k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>6 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
          <blockquote>
<p>转载信息：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html">Commit message 和 Change log 编写指南</a>（https://www.ruanyifeng.com/blog/2016/01/commit_message_change_log.html）<br />
原文作者：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.ruanyifeng.com/">阮一峰</a>（https://www.ruanyifeng.com/）<br />
版权声明：自由转载-非商用-非衍生-保持署名（<a target="_blank" rel="noopener external nofollow noreferrer" href="http://creativecommons.org/licenses/by-nc-nd/3.0/deed.zh">创意共享3.0许可证</a>）<br />
发表日期：2016年 1月 6日</p>
</blockquote>
<p>Git 每次提交代码，都要写 Commit message（提交说明），否则就不允许提交。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit -m <span class="string">&quot;hello world&quot;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面代码的<code>-m</code>参数，就是用来指定 commit mesage 的。</p>
<p>如果一行不够，可以只执行<code>git commit</code>，就会跳出文本编辑器，让你写多行。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git commit</span><br></pre></td></tr></table></figure>
</blockquote>
<p>基本上，你写什么都行（<a target="_blank" rel="noopener external nofollow noreferrer" href="http://www.commitlogsfromlastnight.com/">这里</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="http://blog.no-panic.at/2014/10/20/funny-initial-git-commit-messages/">这里</a>和<a target="_blank" rel="noopener external nofollow noreferrer" href="http://whatthecommit.com/">这里</a>）。</p>
<figure>
<img data-src="https://www.ruanyifeng.com/blogimg/asset/2016/bg2016010601.png" alt="" /><figcaption>img</figcaption>
</figure>
<p>但是，一般来说，commit message 应该清晰明了，说明本次提交的目的。</p>
<figure>
<img data-src="https://www.ruanyifeng.com/blogimg/asset/2016/bg2016010602.png" alt="" /><figcaption>img</figcaption>
</figure>
<p>目前，社区有多种 Commit message 的<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ajoslin/conventional-changelog/blob/master/conventions">写法规范</a>。本文介绍<a target="_blank" rel="noopener external nofollow noreferrer" href="https://docs.google.com/document/d/1QrDFcIiPjSLDn3EL15IJygNPiHORgU1_OOAqWjiDU5Y/edit#heading=h.greljkmo14y0">Angular 规范</a>（见上图），这是目前使用最广的写法，比较合理和系统化，并且有配套的工具。</p>
<h2 id="commit-message-的作用">Commit message 的作用</h2>
<p>格式化的Commit message，有几个好处。</p>
<p><strong>（1）提供更多的历史信息，方便快速浏览。</strong></p>
<p>比如，下面的命令显示上次发布后的变动，每个commit占据一行。你只看行首，就知道某次 commit 的目的。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> &lt;last tag&gt; HEAD --pretty=format:%s</span><br></pre></td></tr></table></figure>
</blockquote>
<figure>
<img data-src="https://www.ruanyifeng.com/blogimg/asset/2016/bg2016010604.png" alt="" /><figcaption>img</figcaption>
</figure>
<p><strong>（2）可以过滤某些commit（比如文档改动），便于快速查找信息。</strong></p>
<p>比如，下面的命令仅仅显示本次发布新增加的功能。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ git <span class="built_in">log</span> &lt;last release&gt; HEAD --grep feature</span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>（3）可以直接从commit生成Change log。</strong></p>
<p>Change Log 是发布新版本时，用来说明与上一个版本差异的文档，详见后文。</p>
<figure>
<img data-src="https://www.ruanyifeng.com/blogimg/asset/2016/bg2016010603.png" alt="" /><figcaption>img</figcaption>
</figure>
<h2 id="commit-message-的格式">Commit message 的格式</h2>
<p>每次提交，Commit message 都包括三个部分：Header，Body 和 Footer。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="built_in">type</span>&gt;(&lt;scope&gt;): &lt;subject&gt;</span><br><span class="line">// 空一行</span><br><span class="line">&lt;body&gt;</span><br><span class="line">// 空一行</span><br><span class="line">&lt;footer&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>其中，Header 是必需的，Body 和 Footer 可以省略。</p>
<p>不管是哪一个部分，任何一行都不得超过72个字符（或100个字符）。这是为了避免自动换行影响美观。</p>
<h3 id="header">Header</h3>
<p>Header部分只有一行，包括三个字段：<code>type</code>（必需）、<code>scope</code>（可选）和<code>subject</code>（必需）。</p>
<p><strong>（1）type</strong></p>
<p><code>type</code>用于说明 commit 的类别，只允许使用下面7个标识。</p>
<blockquote>
<ul>
<li>feat：新功能（feature）</li>
<li>fix：修补bug</li>
<li>docs：文档（documentation）</li>
<li>style： 格式（不影响代码运行的变动）</li>
<li>refactor：重构（即不是新增功能，也不是修改bug的代码变动）</li>
<li>test：增加测试</li>
<li>chore：构建过程或辅助工具的变动</li>
</ul>
</blockquote>
<p>如果<code>type</code>为<code>feat</code>和<code>fix</code>，则该 commit 将肯定出现在 Change log 之中。其他情况（<code>docs</code>、<code>chore</code>、<code>style</code>、<code>refactor</code>、<code>test</code>）由你决定，要不要放入 Change log，建议是不要。</p>
<p><strong>（2）scope</strong></p>
<p><code>scope</code>用于说明 commit 影响的范围，比如数据层、控制层、视图层等等，视项目不同而不同。</p>
<p><strong>（3）subject</strong></p>
<p><code>subject</code>是 commit 目的的简短描述，不超过50个字符。</p>
<blockquote>
<ul>
<li>以动词开头，使用第一人称现在时，比如<code>change</code>，而不是<code>changed</code>或<code>changes</code></li>
<li>第一个字母小写</li>
<li>结尾不加句号（<code>.</code>）</li>
</ul>
</blockquote>
<h3 id="body">Body</h3>
<p>Body 部分是对本次 commit 的详细描述，可以分成多行。下面是一个范例。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">More detailed explanatory text, <span class="keyword">if</span> necessary.  Wrap it to </span><br><span class="line">about 72 characters or so. </span><br><span class="line"></span><br><span class="line">Further paragraphs come after blank lines.</span><br><span class="line"></span><br><span class="line">- Bullet points are okay, too</span><br><span class="line">- Use a hanging indent</span><br></pre></td></tr></table></figure>
</blockquote>
<p>有两个注意点。</p>
<p>（1）使用第一人称现在时，比如使用<code>change</code>而不是<code>changed</code>或<code>changes</code>。</p>
<p>（2）应该说明代码变动的动机，以及与以前行为的对比。</p>
<h3 id="footer">Footer</h3>
<p>Footer 部分只用于两种情况。</p>
<p><strong>（1）不兼容变动</strong></p>
<p>如果当前代码与上一个版本不兼容，则 Footer 部分以<code>BREAKING CHANGE</code>开头，后面是对变动的描述、以及变动理由和迁移方法。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">BREAKING CHANGE: isolate scope bindings definition has changed.</span><br><span class="line"></span><br><span class="line"> To migrate the code follow the example below:</span><br><span class="line"></span><br><span class="line"> Before:</span><br><span class="line"></span><br><span class="line"> scope: &#123;</span><br><span class="line">   myAttr: <span class="string">&#x27;attribute&#x27;</span>,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> After:</span><br><span class="line"></span><br><span class="line"> scope: &#123;</span><br><span class="line">   myAttr: <span class="string">&#x27;@&#x27;</span>,</span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> The removed `inject` wasn<span class="string">&#x27;t generaly useful for directives so there should be no code using it.</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p><strong>（2）关闭 Issue</strong></p>
<p>如果当前 commit 针对某个issue，那么可以在 Footer 部分关闭这个 issue 。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Closes <span class="comment">#234</span></span><br></pre></td></tr></table></figure>
</blockquote>
<p>也可以一次关闭多个 issue 。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Closes <span class="comment">#123, #245, #992</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h3 id="revert">Revert</h3>
<p>还有一种特殊情况，如果当前 commit 用于撤销以前的 commit，则必须以<code>revert:</code>开头，后面跟着被撤销 Commit 的 Header。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">revert: feat(pencil): add <span class="string">&#x27;graphiteWidth&#x27;</span> option</span><br><span class="line"></span><br><span class="line">This reverts commit 667ecc1654a317a13331b17617d973392f415f02.</span><br></pre></td></tr></table></figure>
</blockquote>
<p>Body部分的格式是固定的，必须写成<code>This reverts commit &lt;hash&gt;.</code>，其中的<code>hash</code>是被撤销 commit 的 SHA 标识符。</p>
<p>如果当前 commit 与被撤销的 commit，在同一个发布（release）里面，那么它们都不会出现在 Change log 里面。如果两者在不同的发布，那么当前 commit，会出现在 Change log 的<code>Reverts</code>小标题下面。</p>
<h2 id="commitizen">Commitizen</h2>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/commitizen/cz-cli">Commitizen</a>是一个撰写合格 Commit message 的工具。</p>
<p>安装命令如下。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g commitizen</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后，在项目目录里，运行下面的命令，使其支持 Angular 的 Commit message 格式。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ commitizen init cz-conventional-changelog --save --save-exact</span><br></pre></td></tr></table></figure>
</blockquote>
<p>以后，凡是用到<code>git commit</code>命令，一律改为使用<code>git cz</code>。这时，就会出现选项，用来生成符合格式的 Commit message。</p>
<figure>
<img data-src="https://www.ruanyifeng.com/blogimg/asset/2016/bg2016010605.png" alt="" /><figcaption>img</figcaption>
</figure>
<h2 id="validate-commit-msg">validate-commit-msg</h2>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kentcdodds/validate-commit-msg">validate-commit-msg</a> 用于检查 Node 项目的 Commit message 是否符合格式。</p>
<p>它的安装是手动的。首先，拷贝下面这个<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/kentcdodds/validate-commit-msg/blob/master/index.js">JS文件</a>，放入你的代码库。文件名可以取为<code>validate-commit-msg.js</code>。</p>
<p>接着，把这个脚本加入 Git 的 hook。下面是在<code>package.json</code>里面使用 <a target="_blank" rel="noopener external nofollow noreferrer" href="http://npm.im/ghooks">ghooks</a>，把这个脚本加为<code>commit-msg</code>时运行。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&quot;config&quot;</span>: &#123;</span><br><span class="line">  <span class="string">&quot;ghooks&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;commit-msg&quot;</span>: <span class="string">&quot;./validate-commit-msg.js&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>然后，每次<code>git commit</code>的时候，这个脚本就会自动检查 Commit message 是否合格。如果不合格，就会报错。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ git add -A </span><br><span class="line">$ git commit -m <span class="string">&quot;edit markdown&quot;</span> </span><br><span class="line">INVALID COMMIT MSG: does not match <span class="string">&quot;&lt;type&gt;(&lt;scope&gt;): &lt;subject&gt;&quot;</span> ! was: edit markdown</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="生成-change-log">生成 Change log</h2>
<p>如果你的所有 Commit 都符合 Angular 格式，那么发布新版本时， Change log 就可以用脚本自动生成（<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ajoslin/conventional-changelog/blob/master/CHANGELOG.md">例1</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/karma-runner/karma/blob/master/CHANGELOG.md">例2</a>，<a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/btford/grunt-conventional-changelog/blob/master/CHANGELOG.md">例3</a>）。</p>
<p>生成的文档包括以下三个部分。</p>
<blockquote>
<ul>
<li>New features</li>
<li>Bug fixes</li>
<li>Breaking changes.</li>
</ul>
</blockquote>
<p>每个部分都会罗列相关的 commit ，并且有指向这些 commit 的链接。当然，生成的文档允许手动修改，所以发布前，你还可以添加其他内容。</p>
<p><a target="_blank" rel="noopener external nofollow noreferrer" href="https://github.com/ajoslin/conventional-changelog">conventional-changelog</a> 就是生成 Change log 的工具，运行下面的命令即可。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ npm install -g conventional-changelog</span><br><span class="line">$ <span class="built_in">cd</span> my-project</span><br><span class="line">$ conventional-changelog -p angular -i CHANGELOG.md -w</span><br></pre></td></tr></table></figure>
</blockquote>
<p>上面命令不会覆盖以前的 Change log，只会在<code>CHANGELOG.md</code>的头部加上自从上次发布以来的变动。</p>
<p>如果你想生成所有发布的 Change log，要改为运行下面的命令。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ conventional-changelog -p angular -i CHANGELOG.md -w -r 0</span><br></pre></td></tr></table></figure>
</blockquote>
<p>为了方便使用，可以将其写入<code>package.json</code>的<code>scripts</code>字段。</p>
<blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">    <span class="string">&quot;changelog&quot;</span>: <span class="string">&quot;conventional-changelog -p angular -i CHANGELOG.md -w -r 0&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<p>以后，直接运行下面的命令即可。</p>
<blockquote>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ npm run changelog</span><br></pre></td></tr></table></figure>
</blockquote>
<p>（完）</p>

      
    </div>

    
    
    

    <footer class="post-footer">
        <div class="post-eof"></div>
      
    </footer>
  </article>
</div>





</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 
    <span itemprop="copyrightYear">2023</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">ChiuJun</span>
  </div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">9k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">34 分钟</span>
  </span>
</div>
<div class="busuanzi-count">
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" rel="noopener external nofollow noreferrer" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener external nofollow noreferrer" target="_blank">NexT.Gemini</a> 强力驱动
  </div>
  <style>
    .footer .footer-inner .wordcount {
      display: none;
    }
  </style>
  <div class="moe-beian">
    <a href="https://icp.gov.moe/?keyword=20230706" rel="noopener external nofollow noreferrer" target="_blank" one-link-mark="yes">
      萌ICP备20230706号
    </a>
  </div>
  <style>
    .footer .footer-inner .copyright {
      order: -1;
    }
    .footer .footer-inner .moe-beian {
      order: -1;
    }
  </style>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>

  <script class="next-config" data-name="pdf" type="application/json">{"object_url":{"url":"https://cdnjs.cloudflare.com/ajax/libs/pdfobject/2.2.12/pdfobject.min.js","integrity":"sha256-g2xji1rlE3KsGVClvuxTbcR0Kn2+wtQADSff2Tbb4zA="},"url":"/lib/pdf/web/viewer.html"}</script>
  <script src="/js/third-party/tags/pdf.js"></script>

  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"default","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/10.2.3/mermaid.min.js","integrity":"sha256-JFptYy4KzJ5OQP+Q9fubNf3cxpPPmZKqUOovyEONKrQ="}}</script>
  <script src="/js/third-party/tags/mermaid.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="disqus" type="application/json">{"enable":true,"shortname":"chiujun","count":true,"i18n":{"disqus":"disqus"}}</script>
<script src="/js/third-party/comments/disqus.js"></script>

</body>
</html>
